<%- include('../partials/header') %>

<div class="container mt-4">
  <h1 class="mb-4">Restaurantes Registados</h1>

  <!-- Filtros -->
  <form method="GET" class="row g-3 mb-4">
    <div class="col-md-3">
      <input type="text" class="form-control" name="name" placeholder="Nome"
        value="<%= filtros?.name || '' %>">
    </div>

    <div class="col-md-2">
      <select name="category" class="form-select">
        <option value="">Categoria</option>
        <option value="Carne" <%= filtros?.category === 'Carne' ? 'selected' : '' %>>Carne</option>
        <option value="Peixe" <%= filtros?.category === 'Peixe' ? 'selected' : '' %>>Peixe</option>
        <option value="Vegetariano" <%= filtros?.category === 'Vegetariano' ? 'selected' : '' %>>Vegetariano</option>
        <option value="Sobremesa" <%= filtros?.category === 'Sobremesa' ? 'selected' : '' %>>Sobremesa</option>
      </select>
    </div>

    <div class="col-md-3">
      <input type="text" class="form-control" name="location" placeholder="Localização"
        value="<%= filtros?.location || '' %>">
    </div>

    <div class="col-md-2">
      <input type="number" name="min" class="form-control" step="0.01" placeholder="Preço mín"
        value="<%= filtros?.min || '' %>">
    </div>

    <div class="col-md-2">
      <input type="number" name="max" class="form-control" step="0.01" placeholder="Preço máx"
        value="<%= filtros?.max || '' %>">
    </div>

    <div class="col-md-12 text-end">
      <button type="submit" class="btn btn-primary">Aplicar Filtros</button>
      <a href="/restaurants/list" class="btn btn-secondary">Limpar</a>
    </div>
  </form>

  <table class="table table-striped table-hover">
    <thead class="table-dark text-center">
      <tr>
        <th>#</th>
        <th>Nome</th>
        <th>Email</th>
        <th>Localização</th>
        <th>Nº de pratos</th>
        <th>Gerir</th>
        <th>Validado</th>
      </tr>
    </thead>
    <tbody class="text-center">
      <% restaurantes.forEach((rest, index) => { %>
        <tr>
          <td><%= index + 1 %></td>
          <td><%= rest.name %></td>
          <td><%= rest.email %></td>
          <td><%= rest.location || '-' %></td>
          <td><%= rest.menu.length %></td>
          <td>
            <% if (session && session.user) { %>
              <a href="/restaurants/<%= rest._id %>/manage" class="btn btn-sm btn-outline-primary">Gerir</a>
            <% } else { %>
              <a href="/restaurants/<%= rest._id %>/menu" class="btn btn-sm btn-outline-info">Ver Pratos</a>
            <% } %>
          </td>          
          <td>
            <% if (rest.validado) { %>
              <span class="badge bg-success">Sim</span>
            <% } else { %>
              <span class="badge bg-danger">Não</span>
            <% } %>
          </td>
        </tr>
      <% }) %>
    </tbody>
  </table>
</div>

<%- include('../partials/footer') %>
